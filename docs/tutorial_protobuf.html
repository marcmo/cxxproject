<!DOCTYPE html><html><head><title>Cxxproject</title><link rel="stylesheet" href="../main.css"><meta http-equiv="Content-Type" content="text/html; charset=utf-8"></head><body><div id="container"><h1><a href="http://github.com/marcmo/cxxproject">Cxxproject</a></h1><p class="tagline"><em class="simple">Simple,</em><em class="flexible">flexible,</em><em class="c_cpp">C/C++</em><em class="buildsystem">Buildsystem</em></p><div id="ribbon"><a href="http://github.com/marcmo/cxxproject">Fork me on GitHub</a></div><ul id="menu"><li><a href="../index.html">Index</a></li><li><a href="../docs/basic_usage.html">Basic Usage</a></li><li><a href="../docs/whyruby.html">Why Ruby?</a></li><li><a href="../docs/tutorial.html">Tutorial</a></li><li><a href="../docs/tutorial_protobuf.html">Tutorial2</a></li><li><a href="../docs/wizard.html">Setup-Tool</a></li><li><a href="../docs/news.html">New and Noteworthy</a></li></ul><div id="content"><h2>Protobuf Tutorial (1)</h2>

<p>This tutorial shows you how to get a more complex project going.
What we want to accomplish is to get the addressbook example from http://code.google.com/apis/protocolbuffers/docs/cpptutorial.html going.
We start at the desired output and let rake and cxx-project tell us what we have to do:) lets see how this works:</p>

<h2>Step 1</h2>

<h3>Goals</h3>

<p>In this step we create a directory-structure with:
* the sources from the protobuf webpage
* minimal rakefile to get going
* a cxxproject-file to get the two executables addressbook_(read|write)</p>

<h3>Code</h3>

<pre><code>mkdir -p protobuf_cxx_example/addressbook
cd protobuf_cxx_example
create addressbook/addressbook_read.cc, addressbook/addressbook_write.cc and addressbook/addressbook.proto from the webpage
please adjust the includes in the *.cc files to #include "addressbook/addressbook.pb.h"

create addressbook/project.rb with:
cxx_configuration do

  exe 'addressbook_write',
    :sources =&gt; ['addressbook_write.cc'],
    :dependencies =&gt; ['addressbook_pb_api']

  exe 'addressbook_read',
    :sources =&gt; ['addressbook_read.cc'],
    :dependencies =&gt; ['addressbook_pb_api']

end
create Rakefile.rb with:
require 'cxxproject'
cxx(FileList['**/project.rb'], "build", "gcc", './') do
</code></pre>

<h3>Explanation</h3>

<p>in the cxx-projectfile we say, that we want to build 2 executables by giving a sourcefile and depending on the addressbook<em>pb</em>api (which will be a library created from the generated sources).
the rakefile simply collects all *project.rb files in all directories, gives build as outputdirectory for the compilation process, chooses gcc as toolchain and . as working directory.</p>

<h3>Next Steps</h3>

<pre class="terminal">
rake
ERROR: while reading config file for addressbook_write: dependent building block "addressbook_pb_api" was specified but not found!
</pre>

<p>This tells us, that we have to tell cxxproject how to get addressbook<em>pb</em>api.</p>

<h2>Step 2</h2>

<h3>Goals</h3>

<p>No we have to tell cxxproject how it can build the building block addressbook<em>pb</em>api.</p>

<h3>Code</h3>

<pre><code>add to addressbook/project.rb:
source_lib'addressbook_pb_api',
  :sources =&gt; ['../build/protoc/addressbook/addressbook.pb.cc'],
  :includes =&gt; ['../build/protoc'],
  :dependencies =&gt; ['protobuf']
</code></pre>

<h3>Explanation</h3>

<p>This tells cxxproject that the library addressbook<em>pb</em>api can be build from the source gen/addressbook/addressbook.pb.cc and that this library depends on the protobuf library</p>

<h3>Next Steps</h3>

<pre class="terminal">
rake
ERROR: while reading config file for addressbook_pb_api: dependent building block "protobuf" was specified but not found!
</pre>

<p>This tells us that cxxproject does not know about a buildingblock for protobuf.</p>

<h2>Step 3</h2>

<h3>Goals</h3>

<p>We want to have a cxx-project buildingblock for the protobuf-library. To start simple this tutorial assumes, that you have installed the protobuf-dev libs (for ubuntu this means, that you should install protobuf-compiler and libprotobuf-dev).</p>

<h3>Code</h3>

<pre><code>create protobuf_project.rb with:
cxx_configuration do
  BinaryLibrary.new('protobuf')
end
</code></pre>

<h3>Explanation</h3>

<p>This tells cxxproject that there is a binary library (located in the default paths) for protobuf.</p>

<h3>Next Steps</h3>

<pre class="terminal">
rake exe:filter
Error build/build/protoc/addressbook/addressbook.pb.cc.o: Don't know how to build task 'build/protoc/addressbook/addressbook.pb.cc'
</pre>

<p>When we now try to build all executables rake tells us, that it does not know how to build addressbook/gen/addressbook/addressbook.pb.cc.</p>

<h2>Step 4</h2>

<h3>Goals</h3>

<p>We have to kick off the protoc compiler. As cxxproject is not aware of pro
tobuf we have to define normal raketasks to get this goal.</p>

<h3>Code</h3>

<pre><code>add to Rakefile.rb:
PROTOC = '/usr/bin/protoc'
GEN_FOLDER = File.join('build', 'protoc')

directory GEN_FOLDER

desc 'protoc addressbook.proto'
file File.join(GEN_FOLDER, 'addressbook', 'addressbook.pb.cc') =&gt; [File.join('addressbook', 'addressbook.proto'), GEN_FOLDER, PROTOC] do
  command = "#{PROTOC} --cpp_out=#{GEN_FOLDER} #{File.join('addressbook', 'addressbook.proto')}"
  sh command
end
</code></pre>

<h3>Explanation</h3>

<p>This tells rake how to create the needed files with protoc.</p>

<h3>Next Steps</h3>

<pre class="terminal">
rake exe:filter
</pre>

<p>This seems to work just fine ...
lets try it out!</p>

<pre class="terminal">
build/addressbook_write.exe test
</pre>

<p>Great!</p>

<h2>Wrap Up</h2>

<p>This short tutorial showed you how to setup the addressbook example from protobuf. In 4 simple steps it builds two executables, using the preinstalled protobuf library on your system.
Make sure to check the accompanying git-repository@https://github.com/gizmomogwai/cxxproject<em>tutorials (branch protobuf</em>tutorial_1).</p>

<p><image src="../images/tutorial_protobuf_image1.svg" width="100%"  /></p>
</div></div></body></html>